<!doctype html>
<html lang="id">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .legend {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
            line-height: 18px;
            color: #555;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 1.0;
        }
        </style>
        <title>Peta Kesesuaian Lahan Pertanian</title>
    </head>
    <body>
        <div id="map"></div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="data/MayoritasTutupanLahan_1.js"></script>
        <script src="data/IndeksKesesuaianLahanPertanian_2.js"></script>
        <script src="data/BatasKabupaten_4.js"></script>
        <script>
            var map = L.map('map', {
                zoomControl: true,
                maxZoom: 28,
                minZoom: 1
            }).fitBounds([[-8.29217116949457, 109.98264670810003], [-7.454614929505336, 110.85971031790008]]);
            var hash = new L.Hash(map);
            var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

            // Pengaturan urutan layer dengan Pane
            map.createPane('pane_GoogleSatellite_0');
            map.getPane('pane_GoogleSatellite_0').style.zIndex = 400;
            map.createPane('pane_MayoritasTutupanLahan_1');
            map.getPane('pane_MayoritasTutupanLahan_1').style.zIndex = 401;
            map.createPane('pane_IndeksKesesuaianLahanPertanian_2');
            map.getPane('pane_IndeksKesesuaianLahanPertanian_2').style.zIndex = 402;
            map.createPane('pane_BatasKabupaten_4');
            map.getPane('pane_BatasKabupaten_4').style.zIndex = 403;

            // Layer Dasar
            var layer_GoogleSatellite_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                pane: 'pane_GoogleSatellite_0',
                attribution: 'Google Satellite',
            });
            layer_GoogleSatellite_0.addTo(map);

            // Style dan Popup untuk setiap layer
            // (Kode untuk style dan popup disederhanakan di sini, gunakan kode dari respons sebelumnya yang sudah lengkap)

            // Layer Batas Kabupaten
            var layer_BatasKabupaten_4 = new L.geoJson(json_BatasKabupaten_4, {
                pane: 'pane_BatasKabupaten_4',
                style: { color: 'rgba(0,0,0,1.0)', weight: 2.5, fillOpacity: 0 }
            });

            // Layer Tutupan Lahan
            function style_MayoritasTutupanLahan_1_0(feature) { /* ... fungsi style ... */ }
            var layer_MayoritasTutupanLahan_1 = new L.geoJson(json_MayoritasTutupanLahan_1, {
                pane: 'pane_MayoritasTutupanLahan_1',
                style: feature => {
                    switch(String(feature.properties['_majority'])) {
                        case '6.0': return {fillColor: '#d7191c', fillOpacity: 1.0, weight: 0.5, color: 'rgba(35,35,35,0.4)'};
                        case '1.0': return {fillColor: '#1a9641', fillOpacity: 1.0, weight: 0.5, color: 'rgba(35,35,35,0.4)'};
                        case '4.0': return {fillColor: '#fdae61', fillOpacity: 1.0, weight: 0.5, color: 'rgba(35,35,35,0.4)'};
                        case '5.0': return {fillColor: '#a6d96a', fillOpacity: 1.0, weight: 0.5, color: 'rgba(35,35,35,0.4)'};
                    }
                }
            });

            // Layer Indeks Kesesuaian Lahan
            var layer_IndeksKesesuaianLahanPertanian_2; // Deklarasi dulu
            function onEachFeature_Indeks(feature, layer) { /* ... fungsi popup & highlight ... */ }
            layer_IndeksKesesuaianLahanPertanian_2 = new L.geoJson(json_IndeksKesesuaianLahanPertanian_2, {
                pane: 'pane_IndeksKesesuaianLahanPertanian_2',
                onEachFeature: onEachFeature_Indeks,
                style: feature => { /* ... fungsi style ... */ }
            });
            
            // --- REVISI UTAMA: Pengaturan Layer yang Tampil ---
            
            // Tambahkan layer utama ke peta secara default
            layer_IndeksKesesuaianLahanPertanian_2.addTo(map);

            var baseMaps = {
                "Google Satelit": layer_GoogleSatellite_0,
            };

            var overlayMaps = {
                // Layer ini akan aktif secara default karena sudah ditambahkan ke map
                "<span style='font-weight:bold'>Indeks Kesesuaian Lahan</span>": layer_IndeksKesesuaianLahanPertanian_2,
                "Mayoritas Tutupan Lahan": layer_MayoritasTutupanLahan_1,
                "Batas Kabupaten": layer_BatasKabupaten_4,
            };

            L.control.layers(baseMaps, overlayMaps, {
                position: 'topright',
                collapsed: false
            }).addTo(map);

            // Legenda (kode legenda dari respons sebelumnya)
            var legend = L.control({position: 'bottomright'});
            legend.onAdd = function (map) { /* ... fungsi legenda ... */ };
            legend.addTo(map);

        </script>
    </body>
</html>
