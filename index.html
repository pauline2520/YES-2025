<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Peta Kesesuaian Lahan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="css/fontawesome-all.min.css">
  <style>
    html, body, #map {
      height: 100%; width: 100%; margin: 0; padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }
    .leaflet-control-layers {
      box-shadow: 0 1px 5px rgba(0,0,0,0.4);
      border-radius: 6px;
      background: rgba(255,255,255,0.95);
    }
    .layer-legend {
      font-size: 13px; padding: 6px; background: #fff;
      border: 1px solid #ccc; margin-top: 4px;
      border-radius: 4px;
    }
    .layer-legend i {
      display: inline-block; width: 18px; height: 18px;
      margin-right: 6px; border: 1px solid #555;
    }
    .leaflet-popup-content th, .leaflet-popup-content td {
      font-size: 13px; padding: 3px 6px; text-align: left;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script src="js/leaflet.js"></script>
<script src="data/BatasKabupaten_4.js"></script>
<script src="data/IndeksKesesuaianLahanPertanian_2.js"></script>
<script src="data/MayoritasTutupanLahan_1.js"></script>
<script>
var map = L.map('map').setView([-7.87, 110.4], 10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

// Style Indeks Kesesuaian
function styleIndeks(feature) {
  return {
    weight: 1, color: '#333', fillOpacity: 1,
    fillColor: {
      'Sangat Sesuai (S1)': '#2B83BA',
      'Cukup Sesuai (S2)': '#C7E8AD',
      'Sesuai Marginal (S3)': '#FEC980',
      'Tidak Sesuai (N)': '#D7191C'
    }[feature.properties.Cluster] || '#ccc'
  };
}

var layer_Indeks = L.geoJson(json_IndeksKesesuaianLahanPertanian_2, {
  style: styleIndeks,
  onEachFeature: function(feature, layer) {
    var p = feature.properties;
    layer.bindPopup(`<b>Desa:</b> ${p.NAMOBJ}<br>
<b>Kabupaten:</b> ${p.WADMKK}<br>
<b>Kesesuaian:</b> ${p.Cluster}<br>
<b>Vegetasi:</b> ${p['Dimensi Ve']}<br>
<b>Cuaca:</b> ${p['Dimensi Cu']}<br>
<b>Tanah:</b> ${p['Dimensi Ta']}<br>
<b>Topografi:</b> ${p['Dimensi To']}<br>
<b>Akses:</b> ${p['Dimensi Ak']}<br>
<b>Rekomendasi:</b> ${p.Rekomendas}`);
  }
}).addTo(map);

// Style Tutupan Lahan
function styleLandcover(f) {
  var warna = {
    1: '#397d49', 4: '#e49635', 5: '#dfc35a', 6: '#c4281b'
  };
  return {color: warna[f.properties._majority] || '#ccc', fillOpacity: 1, weight: 0.5};
}

var layer_Tutupan = L.geoJson(json_MayoritasTutupanLahan_1, {
  style: styleLandcover,
  onEachFeature: function(feature, layer) {
    var lc = {
      1: 'Hutan', 4: 'Lahan Pertanian', 5: 'Semak Belukar', 6: 'Permukiman'
    }[feature.properties._majority] || 'Lainnya';
    layer.bindPopup(`<b>Desa:</b> ${feature.properties.NAMOBJ}<br><b>Kabupaten:</b> ${feature.properties.WADMKK}<br><b>Tutupan:</b> ${lc}`);
  }
}).addTo(map);

var layer_Batas = L.geoJson(json_BatasKabupaten_4, {
  style: {color: '#000', weight: 2, fill: false}
}).addTo(map);

L.control.layers(null, {
  'Indeks Kesesuaian': layer_Indeks,
  'Mayoritas Tutupan Lahan': layer_Tutupan,
  'Batas Kabupaten': layer_Batas
}).addTo(map);
</script>
</body>
</html>
